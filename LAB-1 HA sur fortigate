ğŸ” Lab GNS3 â€“ IntÃ©gration FortiGate HA & Cisco Routing

ğŸ“Œ Objectif

Ce lab a pour objectif de simuler une architecture sÃ©curisÃ©e intÃ©grant :

2 x Fortinet FortiGate VM en High Availability (HA Active-Passive)

Des routeurs Cisco Systems (CSR / IOU)

Des hÃ´tes simulÃ©s via VPCS

Il couvre :

Configuration des interfaces

Routage statique

Mise en place HA FortiGate

VÃ©rification des flux

Debug avancÃ© (flow inspection)

ğŸ—ºï¸ Topologie

<img width="1120" height="858" alt="image" src="https://github.com/user-attachments/assets/cb8dcd9b-15ce-4e7e-8d2a-2a21427a35e2" />


ğŸ” Architecture logique
        PC1 (10.0.0.2)
               |
              R1
               |
        192.168.0.0/24
          |         |
        FGT1      FGT2
          |         |
        192.168.2.0/24
               |
              IOU2
               |
              PC2
ğŸŒ Plan dâ€™Adressage
Ã‰quipement	Interface	Adresse IP	RÃ´le
FGT1	port1	192.168.0.1/24	WAN
FGT1	port2	192.168.2.1/24	LAN
FGT2	port1	192.168.0.2/24	WAN
FGT2	port2	192.168.2.2/24	LAN
R1	e0/0	192.168.0.254/24	Vers FortiGate
R1	e0/1	10.0.0.1/24	LAN PC1
IOU2	e0/0	192.168.2.253/24	LAN PC2
PC1	e0	10.0.0.2/24	Client
PC2	e0	192.168.2.100/24	Client
ğŸ”¹ Passerelles par dÃ©faut

PC1 â†’ 10.0.0.1

PC2 â†’ 192.168.2.1 (VIP HA)

ğŸ› ï¸ Environnement

GNS3

FortiGate VM64-KVM

Cisco CSR1000v / IOU

VPCS

ğŸ”¥ Configuration FortiGate
1ï¸âƒ£ Configuration Interfaces â€“ FGT1
config system interface
    edit "port1"
        set ip 192.168.0.1 255.255.255.0
        set allowaccess ping https ssh
    next
    edit "port2"
        set ip 192.168.2.1 255.255.255.0
        set allowaccess ping https ssh
    next
end
2ï¸âƒ£ Routage Statique
config router static
    edit 1
        set dst 10.0.0.0 255.255.255.0
        set gateway 192.168.0.254
    next
end
ğŸ” Configuration HA (Active-Passive)
Sur FGT1 (Primary)
config system ha
    set mode a-p
    set group-name "FGT-HA-LAB"
    set password FortiHA123
    set hbdev "port3" 50
    set priority 200
end
Sur FGT2 (Secondary)
config system ha
    set mode a-p
    set group-name "FGT-HA-LAB"
    set password FortiHA123
    set hbdev "port3" 50
    set priority 100
end
âœ… VÃ©rification HA
get system ha status
execute ha status
get system performance status

RÃ©sultat attendu :

FGT1 â†’ Master

FGT2 â†’ Slave

Synchronisation : OK

ğŸ” Configuration Policy Firewall

Autoriser le trafic LAN â†” WAN :

config firewall policy
    edit 1
        set name "LAN_to_WAN"
        set srcintf "port2"
        set dstintf "port1"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set nat enable
    next
end
ğŸ”€ Configuration Routeur Cisco R1
enable
configure terminal
hostname R1

interface Ethernet0/0
 ip address 192.168.0.254 255.255.255.0
 no shutdown

interface Ethernet0/1
 ip address 10.0.0.1 255.255.255.0
 no shutdown

ip route 192.168.2.0 255.255.255.0 192.168.0.1
end
ğŸ”€ Configuration IOU2
enable
configure terminal
hostname IOU2

interface Ethernet0/0
 ip address 192.168.2.253 255.255.255.0
 no shutdown

ip route 0.0.0.0 0.0.0.0 192.168.2.1
end
ğŸ§ª Tests de ConnectivitÃ©
Depuis PC1
ping 192.168.2.100
VÃ©rification Table de Routage

FortiGate :

get router info routing-table all

Cisco :

show ip route
ğŸ Debug AvancÃ© FortiGate (Flow Analysis)

TrÃ¨s important pour comprendre le traitement des paquets :

diagnose debug reset
diagnose debug flow filter addr 10.0.0.2
diagnose debug flow show function-name enable
diagnose debug enable

Puis lancer un ping.

Pour arrÃªter :

diagnose debug disable
ğŸ¯ Points ClÃ©s PÃ©dagogiques

ComprÃ©hension du fonctionnement HA Active/Passive

Synchronisation configuration

RÃ´le des prioritÃ©s

Impact dâ€™un failover

Routage statique inter-Ã©quipements

Analyse de flux via debug

ğŸ§  Conclusion

Ce lab permet de :

DÃ©ployer une architecture sÃ©curisÃ©e hybride Cisco / FortiGate

ImplÃ©menter une haute disponibilitÃ©

MaÃ®triser le troubleshooting FortiGate

Simuler un environnement proche dâ€™une production entreprise
