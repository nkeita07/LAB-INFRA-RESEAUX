
üîê Lab GNS3 ‚Äì VLAN Segmentation & DHCP sur FortiGate
üìå Objectif

Ce lab d√©montre la mise en place :

Segmentation r√©seau via VLAN 802.1Q

Routage inter-VLAN assur√© par un FortiGate

DHCP Server configur√© sur chaque VLAN

Contr√¥le des flux inter-VLAN via policies

Acc√®s Internet via NAT

Architecture simul√©e sous GNS3 avec :

Fortinet FortiGate VM

Switch L2 (IOU)

VPCS pour les h√¥tes

Cloud NAT GNS3

üó∫Ô∏è Topologie

üîé Architecture Logique
                 INTERNET (Cloud1)
                        |
                     Port1 (WAN)
                   FortiGate
                        |
                   Port2 (Trunk)
                        |
                     Switch L2
        ---------------------------------
        |               |               |
     VLAN 10         VLAN 20         VLAN 30
     IT               RETAIL          SERVICE
üåê Plan d‚ÄôAdressage
VLAN	Nom	Subnet	Gateway (FortiGate)
10	IT	192.168.10.0/24	192.168.10.1
20	RETAIL	192.168.20.0/24	192.168.20.1
30	SERVICE	192.168.30.0/24	192.168.30.1

WAN : DHCP (Cloud GNS3 ‚Üí 192.168.236.173)

üõ†Ô∏è Configuration Switch (IOU1)
Cr√©ation des VLANs
enable
configure terminal

vlan 10
 name IT

vlan 20
 name RETAIL

vlan 30
 name SERVICE
Configuration ports access
interface e0/1
 switchport mode access
 switchport access vlan 10

interface e0/2
 switchport mode access
 switchport access vlan 20

interface e0/3
 switchport mode access
 switchport access vlan 30
Configuration Trunk vers FortiGate
interface e0/0
 switchport trunk encapsulation dot1q
 switchport mode trunk
üî• Configuration FortiGate
1Ô∏è‚É£ Interface WAN
config system interface
    edit "port1"
        set mode dhcp
        set allowaccess ping https ssh
    next
end
2Ô∏è‚É£ Cr√©ation des Interfaces VLAN (Subinterfaces)
config system interface

    edit "VLAN10_IT"
        set interface "port2"
        set vlanid 10
        set ip 192.168.10.1 255.255.255.0
    next

    edit "VLAN20_RETAIL"
        set interface "port2"
        set vlanid 20
        set ip 192.168.20.1 255.255.255.0
    next

    edit "VLAN30_SERVICE"
        set interface "port2"
        set vlanid 30
        set ip 192.168.30.1 255.255.255.0
    next

end

üëâ Ici, port2 fonctionne en trunk 802.1Q.

üì¶ Configuration DHCP Server
VLAN 10
config system dhcp server
    edit 1
        set interface "VLAN10_IT"
        set lease-time 86400
        config ip-range
            edit 1
                set start-ip 192.168.10.10
                set end-ip 192.168.10.100
            next
        end
        set netmask 255.255.255.0
        set default-gateway 192.168.10.1
    next
end
VLAN 20
edit 2
    set interface "VLAN20_RETAIL"
    set lease-time 86400
    config ip-range
        edit 1
            set start-ip 192.168.20.10
            set end-ip 192.168.20.100
        next
    end
    set netmask 255.255.255.0
    set default-gateway 192.168.20.1
next
VLAN 30
edit 3
    set interface "VLAN30_SERVICE"
    set lease-time 86400
    config ip-range
        edit 1
            set start-ip 192.168.30.10
            set end-ip 192.168.30.100
        next
    end
    set netmask 255.255.255.0
    set default-gateway 192.168.30.1
next
end
üîê Configuration des Firewall Policies
Inter-VLAN (si autoris√©)

Exemple : IT ‚Üí RETAIL

config firewall policy
    edit 1
        set name "IT_to_RETAIL"
        set srcintf "VLAN10_IT"
        set dstintf "VLAN20_RETAIL"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
    next
end
Acc√®s Internet (NAT)
edit 10
    set name "LAN_to_WAN"
    set srcintf "VLAN10_IT" "VLAN20_RETAIL" "VLAN30_SERVICE"
    set dstintf "port1"
    set srcaddr "all"
    set dstaddr "all"
    set action accept
    set schedule "always"
    set service "ALL"
    set nat enable
next
end
üß™ V√©rifications
V√©rifier DHCP

Sur VPCS :

ip dhcp
show ip
V√©rifier routage
get router info routing-table all
Debug DHCP
diagnose debug reset
diagnose debug application dhcps -1
diagnose debug enable
üéØ Concepts Cl√©s D√©montr√©s

VLAN Tagging (802.1Q)

Router-on-a-Stick via FortiGate

DHCP Scope par VLAN

Segmentation r√©seau

Inter-VLAN routing s√©curis√©

NAT overload vers Internet

Inspection stateful firewall

üß† Valeur Technique du Lab

Ce lab simule une architecture entreprise typique :

S√©paration IT / Retail / Service

Centralisation du routage sur firewall

Distribution automatique IP

Contr√¥le strict des flux lat√©raux

Acc√®s Internet s√©curis√©
